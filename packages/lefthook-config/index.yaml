# @see
# https://github.com/evilmartians/lefthook
#
# Run the command to test:
#   pnpx lefthook run [-v,--verbose] <hook-name>
#
# Examples:
#   pnpx lefthook run --verbose pre-commit
#   pnpx lefthook run --verbose commit-msg
#   pnpx lefthook run --verbose post-merge
commit-msg:
  parallel: true

  jobs:
    - name: commitlint
      run: |
        if [ -f "pnpm-lock.yaml" ]; then
          pnpx commitlint@latest --edit {1} --verbose
          exit 0
        fi

        if [ -f "package-lock.json" ]; then
          npx commitlint@latest --edit {1} --verbose
          exit 0
        fi

post-merge:
  parallel: true

  jobs:
    - name: delete-merged-branches
      run: git branch --merged | grep -Ev '\*|master|main|dev|develop|development|stag|staging|prod|production' | xargs git branch -d; git fetch --prune;

    - name: install-packages
      env:
        LEFTHOOK_VERBOSE: 'true'
      interactive: true
      files: git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD
      glob: '**/{package.json,pnpm-lock.yaml,yarn.lock,package-lock.json}'
      run: |
        if [ -f "pnpm-lock.yaml" ]; then
          echo "ðŸ¥Š Installing dependencies with pnpm..."
          yes | pnpm install
          exit 0
        fi

        if [ -f "package-lock.json" ]; then
          echo "ðŸ¥Š Installing dependencies with npm..."
          npm install
          exit 0
        fi
